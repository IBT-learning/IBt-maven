pipeline {
    agent any

    tools {
         maven 'maven_3.9.1'
        }

    stages{


        stage('Github connection'){
            steps{
                git branch: 'april2024_godson',
                credentialsId: 'newTokenGit',
                url: 'https://github.com/IBT-learning/ibt-maven.git'
            }
        }


        stage('Maven validate'){
            steps{
                withMaven(
                maven: 'maven_3.8.1',
                mavenSettingsConfig: 'settingsFile',
                traceability: true) {
                sh '''
                    mvn --version
                    mvn validate
                    '''
        }
                }
        }

        stage('Maven compile'){
            steps{
                sh '''
                    mvn --version
                    mvn compile
                    '''
            }
        }

        stage('Maven test'){
            steps{
                sh '''
                    mvn test
                    '''
            }
        }


        stage('Maven package'){
            steps{
                sh '''
                    mvn package
                    '''
            }
        }

        stage('Auth stage'){
            steps{
                input {
                    message 'Kindly Approve'
                    ok 'Submit'
                    parameters {
                        string defaultValue: 'Godson', description: 'firstname', name: 'firstname', trim: true
                    }
}

            }
        }

        stage('Deploy with Managed'){
            steps{
                script{
                    echo "Project approved by $firstname"
                }
                configFileProvider([configFile(fileId: 'settingsFile', targetLocation: 'settingsFile', variable: 'settingsFile')]) {
                 sh 'mvn -s $settingsFile deploy'

}
            }

        }






    }
}